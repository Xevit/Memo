%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Plantilla de memoria en LaTeX para la ETSIT - Universidad Rey Juan Carlos
%%
%% Por Gregorio Robles <grex arroba gsyc.urjc.es>
%%     Grupo de Sistemas y Comunicaciones
%%     Escuela Técnica Superior de Ingenieros de Telecomunicación
%%     Universidad Rey Juan Carlos
%% (muchas ideas tomadas de Internet, colegas del GSyC, antiguos alumnos...
%%  etc. Muchas gracias a todos)
%%
%% La última versión de esta plantilla está siempre disponible en:
%%     https://github.com/gregoriorobles/plantilla-memoria
%%
%% Para obtener PDF, ejecuta en la shell:
%%   make
%% (las imágenes deben ir en PNG o JPG)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[a4paper, 12pt]{book}
%\usepackage[T1]{fontenc}

\usepackage[a4paper, left=2.5cm, right=2.5cm, top=3cm, bottom=3cm]{geometry}
\usepackage{times}
\usepackage[latin1]{inputenc}
\usepackage[spanish]{babel} % Comenta esta línea si tu memoria es en inglés
\usepackage[hyphens]{url}
\usepackage[breaklinks = true]{hyperref}
%\usepackage[dvipdfm]{graphicx}
\usepackage{graphicx}
\usepackage{float}  %% H para posicionar figuras
\usepackage[nottoc, notlot, notlof, notindex]{tocbibind} %% Opciones de índice
\usepackage{latexsym}  %% Logo LaTeX
\usepackage[export]{adjustbox}
\usepackage{hyperref}

\title{Memoria del Proyecto}
\author{Nombre del autor}

\renewcommand{\baselinestretch}{1.5}  %% Interlineado

\begin{document}

\renewcommand{\refname}{Bibliografía}  %% Renombrando
\renewcommand{\appendixname}{Apéndice}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PORTADA

\begin{titlepage}
\begin{center}
\begin{tabular}[c]{c c}
%\includegraphics[bb=0 0 194 352, scale=0.25]{logo} &
\includegraphics[scale=0.25]{img/logo_vect.png} &
\begin{tabular}[b]{l}
\Huge
\textsf{UNIVERSIDAD} \\
\Huge
\textsf{REY JUAN CARLOS} \\
\end{tabular}
\\
\end{tabular}

\vspace{1cm}

\large
ESCUELA TÉCNICA SUPERIOR DE INGENIERÍA DE TELECOMUNICACIÓN

\Large
GRADO EN INGENIERÍA EN TECNOLOGÍAS DE LA TELECOMUNICACIÓN

\vspace{0.1cm}

\large
Curso Académico 2018/2019

\vspace{0.4cm}

Trabajo Fin de Grado

\vspace{0.7cm}

\LARGE
CREACIÓN DE LOS MECANISMOS NECESARIOS PARA LA CONCESIÓN DE AUTORIZACIÓN ENTRE UNA APLICACIÓN Y UNA API A TRAVÉS DE UNA IMPLEMENTACIÓN DEL ESTÁNDAR OAUTH 2.0


\vspace{4cm}

\large
Autor : Pedro Tello Sánchez \\
Tutor : Pedro de las Heras Quirós
\end{center}
\end{titlepage}

\newpage
\mbox{}
\thispagestyle{empty} % para que no se numere esta pagina


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Para firmar
\clearpage
\pagenumbering{gobble}
\chapter*{}

\vspace{-4cm}
\begin{center}
\LARGE
\textbf{Trabajo Fin de Grado}

\vspace{1cm}
\large
Creación de los mecanismos necesarios para la concesión de autorización entre una aplicación y una API a través de una implementación del estándar OAuth 2.0.

\vspace{1cm}
\large
\textbf{Autor :} Pedro Tello Sánchez \\
\textbf{Tutor :} Pedro de las Heras Quirós

\end{center}

\vspace{1cm}
La defensa del presente Proyecto Fin de Carrera se realizó el día \qquad$\;\,$ de \qquad\qquad\qquad\qquad \newline de 2019, siendo calificada por el siguiente tribunal:


\vspace{0.5cm}
\textbf{Presidente:}

\vspace{1.2cm}
\textbf{Secretario:}

\vspace{1.2cm}
\textbf{Vocal:}


\vspace{1.2cm}
y habiendo obtenido la siguiente calificación:

\vspace{1cm}
\textbf{Calificación:}


\vspace{1cm}
\begin{flushright}
Fuenlabrada, a \qquad$\;\,$ de \qquad\qquad\qquad\qquad de 2019
\end{flushright}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Dedicatoria

\chapter*{}
\pagenumbering{Roman} % para comenzar la numeracion de paginas en numeros romanos
\begin{flushright}
\textit{Dedicado a aquellos que confiaron en mí.}
\end{flushright}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Agradecimientos

\chapter*{Agradecimientos}
%\addcontentsline{toc}{chapter}{Agradecimientos} % si queremos que aparezca en el índice
\markboth{AGRADECIMIENTOS}{AGRADECIMIENTOS} % encabezado 

Quiero agradecer este trabajo fin de grado y lo que este fin significa a aquellas personas que me han dado su apoyo, su esperanza, la paciencia y el cariño cuando los necesitaba, los recursos necesarios y muchas veces la motivación que me hacía falta para continuar, desde principio a fin en estos años.\\
\linebreak
Ellos saben quienes son y les estaré eternamente agradecido.\\
\linebreak

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Resumen

\chapter*{Resumen}
%\addcontentsline{toc}{chapter}{Resumen} % si queremos que aparezca en el índice
\markboth{RESUMEN}{RESUMEN} % encabezado
%Aquí viene un resumen del proyecto. Ha de constar de tres o cuatro párrafos, donde se presente de manera clara y concisa de qué va el proyecto. 
%Han de quedar respondidas las siguientes preguntas:
%\begin{itemize}
%  \item ¿De qué va este proyecto? ¿Cuál es su objetivo principal?
%  \item ¿Cómo se ha realizado? ¿Qué tecnologías están involucradas?
%  \item ¿En qué contexto se ha realizado el proyecto? ¿Es un proyecto
%dentro de un marco general?
%\end{itemize}

Los tres pilares básicos de los que consta la seguridad de la información son: la confidencialidad, la integridad y la disponibilidad o autorización. Mientras que la confidencialidad es la propiedad que impide la divulgación de información a individuos o entidades no autorizados, la integridad es la propiedad que busca mantener los datos libres de modificaciones no autorizadas y por último, la disponibilidad o autorización es la cualidad de la información de encontrarse en disposición de quienes deben acceder a ella. Este proyecto ha utilizado la propiedad de disponibilidad o autorización, agregando un mecanismo de autenticación para el control de acceso.

Mientras que la autenticación trata de demostrar que una persona es quién dice ser, la autorización trata de discernir el grado de confianza que se concede para la obtención de un recurso o conjunto de recursos específico. El objetivo principal de este proyecto es la creación de los mecanismos necesarios para la concesión de autorización entre una aplicación y una API mediante una implementación del protocolo OAuth 2.0 (RFC 6749)~\cite{hardt2012rfc}. Para ello se ha creado un mecanismo de control de acceso mediante usuario y contraseña, se ha realizado un proceso de gestión de alta y baja de aplicaciones y finalmente se ha creado desde cero el protocolo OAuth 2.0 utilizando la concesión por código de autorización.

Dicha implementación se ha realizado utilizando Java, JavaScript, HTML y CSS. Para desplegar la aplicación se ha utilizado el servidor de aplicaciones WildFly (en su versión 13). Como base de datos se ha utilizado PostgreSQL.

Este proyecto se ha realizado en el ámbito de la seguridad de la información y la ciberseguridad y trata de demostrar los aspectos positivos de una buena gestión en la autorización de recursos, como lo es la llevada a cabo por el protocolo OAuth 2.0.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Resumen en inglés

\chapter*{Summary}
%\addcontentsline{toc}{chapter}{Summary} % si queremos que aparezca en el índice
\markboth{SUMMARY}{SUMMARY} % encabezado

The three basic pillars of which the security of information consists are: confidentiality, integrity and availability or authorization. While confidentiality is the property that prevents the disclosure of information to unauthorized individuals or entities, integrity is the property that seeks to keep the data free of unauthorized modifications and finally, availability or authorization is the quality of the information of be available to those who must access it. This project has used the availability or authorization property, adding an authentication mechanism for access control.

While authentication tries to prove that a person is who they say they are, the authorization tries to discern the degree of trust that is granted to obtain a specific resource or set of resources. The main objective of this project is the creation of the necessary mechanisms for granting authorization between an application and an API through an implementation of the OAuth 2.0 protocol (RFC 6749)~\cite{hardt2012rfc}. To this end, an access control mechanism has been created through user and password, a process of managing applications has been registered and finally the OAuth 2.0 protocol has been created from scratch using the authorization code concession.

This implementation has been done using Java, JavaScript, HTML and CSS. The application server WildFly (v.13) was used to deploy the application. As a database, PostgreSQL has been used.

This project has been carried out in the field of information security and cybersecurity and tries to demonstrate the positive aspects of good management in the authorization of resources, such as the one carried out by the OAuth 2.0 protocol.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ÍNDICES %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Las buenas noticias es que los índices se generan automáticamente.
% Lo único que tienes que hacer es elegir cuáles quieren que se generen,
% y comentar/descomentar esa instrucción de LaTeX.

%%%% Índice de contenidos
\tableofcontents 
%%%% Índice de figuras
\cleardoublepage
%\addcontentsline{toc}{chapter}{Lista de figuras} % para que aparezca en el indice de contenidos
\listoffigures % indice de figuras
%%%% Índice de tablas
\cleardoublepage
%\addcontentsline{toc}{chapter}{Lista de tablas} % para que aparezca en el indice de contenidos
%\listoftables % indice de tablas


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INTRODUCCIÓN %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Introducción}
\label{sec:intro} % etiqueta para poder referenciar luego en el texto con ~\ref{sec:intro}
\pagenumbering{arabic} % para empezar la numeración de página con números
Este Trabajo Fin de Grado se desarrolla en el ámbito de la seguridad y la preservación de la autenticación y de la autorización~\cite{lai1999user} en Internet. En este capítulo introduciremos los conceptos y tecnologías utilizadas a la vez que se presentará el esquema general de la custodia de la información.
%\\[1\baselineskip]
\section{Historia}
\label{sec:historia}
Internet se ha convertido en el centro de nuestras vidas. Según un estudio realizado por la compañía Brandwatch \footnote{\url{www.brandwatch.com}} en Abril de 2018 la población mundial era de 7.8 mil millones de personas de los cuales 4.2 mil millones de personas eran usuarios de Internet y 3.03 mil millones eran usuarios de redes sociales y/o estaban registrados en páginas web. 

Con tal magnitud de usuarios generando datos en poco tiempo, se llegó a la conclusión, de que la información de los usuarios contenida en diferentes sitios web, podía ser de valor para otras entidades y se comenzaron a crear servicios que permitían el envío de determinada información bajo autorización del propietario de la misma. Así fue como nacieron las API que ofrecían servicios y las Aplicaciones que podrían consumir los mismos. 

El problema surgió cuando para acceder a la información de un determinado usuario era necesario suministrar las credenciales de acceso de dicho usuario. Esa información era crítica y bajo ningún concepto se debería suministrar a alguien que no fuera la API o el usuario. Por tanto se necesitaba conseguir que los usuarios, propietarios de los datos, pudieran disponer de un protocolo seguro mediante el cuál facilitar las credenciales únicamente a la API. Así se llegó a la conclusión de que era necesario encontrar métodos de autenticación que no pusieran en peligro la información personal del usuario a la vez que concedieran los permisos necesarios de autorización para acceder a la información específica que quisiera compartir el usuario.

A lo largo de los años han ido surgiendo diferentes tecnologías que iban proporcionando soluciones tanto al concepto de autorización como al concepto de autenticación. 

%De esta forma nacieron varias tecnologías que servían para este propósito. Una de las que más éxito tuvo fue el protocolo OAuth 1.0 (RFC 5848) que posteriormente fue reemplazada por el protocolo OAuth 2.0 (RFC 6749) el cuál es el más utilizado actualmente y el que va a ser el objeto de estudio del presente TFG.

\section{Diferencias entre autorización y autenticación}
\label{sec:autoautent}
Son dos conceptos que se suelen confundir con bastante frecuencia. Mientras que la autenticación se enfoca en determinar que el usuario es quien dice ser, la autorización se encarga de controlar qué acciones, ese usuario, puede realizar. La siguiente imagen \ref{figura:autent_autor} muestra de una forma más simple, el objeto que trata de realizar cada uno de los dos conceptos (autenticación izquierda, autorización derecha).

\begin{figure}[H]
	\includegraphics[scale=0.2, center]{image/Autor_Autent.jpeg}
	\caption{Autorización VS Autenticación}
	\label{figura:autent_autor}
\end{figure}

\subsection{Autorización}
\label{subsec:autor}
La autorización se encarga de determinar si tenemos autoridad para hacer algo. Pensemos por ejemplo en las aplicaciones móviles en las que existe una versión Lite (gratuita) y una versión Pro (de pago). Un usuario gratuito está autorizado a acceder a un conjunto limitado de funcionalidades y no está autorizado a otras funcionalidades, mientras no pague la suscripción y se convierta en usuario \emph{Premium}. 

Cada vez que un usuario intenta acceder a una funcionalidad, la aplicación realiza un control para determinar si puede hacerlo o no. En segundo plano, lo que está ocurriendo es un proceso de autorización. Siempre que el usuario acceda a recursos para los que tiene permisos, no habrá problema. Sin embargo, en cuanto el usuario intente acceder a un recurso que solo está disponible para la versión Pro, se le denegará el permiso y comunmente se le invita a unirse al paquete \emph{Premium}.

\subsection{Autenticación}
\label{subsec:autent}
La autenticación se define como el proceso mediante el cual se verifica que un individuo, es quien dice ser. 
Un ejemplo sería, por ejemplo, el proceso de autenticación que realiza Google. Cuando se inicia sesión introduciendo un correo electrónico y contraseña estamos autenticándonos. Google está comprobando que la contraseña introducida coincide con la contraseña que se asoció a mi correo electrónico en el momento del registro. Si la contraseña coincide con el correo podremos acceder a la aplicación, sin embargo, si la contraseña no coincide con el correo, Google no permitirá el inicio de sesión porque no se puede asegurar que la persona sea quien dice ser.

Debido a que la posibilidad de que nos roben la contraseña existe, en los últimos años ha surgido la autenticación de dos factores. Dicha autenticación consiste en agregar un segundo paso para verificar que la persona es quien dice ser. Entonces, no solo se necesitaría la contraseña sino que se requeriría un paso adicional. La manera más común de realizar dicha autenticación consiste en enviar un mensaje al correo electrónico desde el cual se está intentando acceder o mediante el envío de un código al teléfono móvil de contacto.

\subsubsection{Autenticación mediante certificados electrónicos}
\label{subsubsec:autentglob}
%Añadir la subsubsection para que puntualice. Y añadir algo de temas de certificados para la autenticación.
A partir de los avances tecnológicos actuales podemos predecir que las contraseñas ya no son un método confiable de autenticación de usuario. Este problema, combinado con la creciente amenaza de máquinas malintencionadas, hace que muchos expertos en TI se pregunten como pueden asegurarse de que solo los usuarios y dispositivos aprobados tengan acceso. La solución a este problema lo podemos encontrar en los certificados electrónicos.

La autenticación basada en certificados es el nombre que se le da a utilizar un certificado digital para identificar a un usuario, máquina o dispositivo antes de otorgar acceso a un recurso, red, aplicación, etc. En el caso de la autenticación de usuario, a menudo se implementa en conjunto con métodos tradicionales como nombre de usuario y contraseña. A diferencia de algunas soluciones que solo funcionan para usuarios, como la biométrica y las contraseñas de un solo uso, la autenticación mediante certificado se puede utilizar para cualquier gestión final: usuarios, máquinas, dispositivos e incluso para gestionar la tecnología creciente de Internet of Things.

La autenticación basada en certificados hace uso de la infraestructura de clave pública (de sus siglas en inglés PKI) para generar un par de claves (una pública y una privada). La privada es personal e intransferible y la pública de libre acceso. De esta forma cualquier intento de acceso por parte del usuario se realizará utilizando la clave privada (firmando el mensaje) para que posteriormente la plataforma destino mediante un mecanismo de validación, haciendo uso de la clave pública de esta entidad, pueda descifrar dicho mensaje. En caso de poder descifrarlo correctamente se podrá afirmar con total certeza que el usuario es quien dice ser y se realizará correctamente la autenticación. 


\section{Mecanismos de autorización y autenticación}
\label{sec:mecanismos}
A continuación se van a exponer dos mecanismos de autorización y autenticación conjunta para finalizar con el mecanismo de autorización en el que vamos a basar este TFG.

\subsection{SAML}
\label{subsec:saml}
Security Assertion Markup Language (SAML) es un estándar abierto que funciona transfiriendo la identidad del usuario desde un proveedor de identidad al proveedor del servicio. Esto se produce mediante el intercambio de documentos XML firmados digitalmente.

Un ejemplo de uso sería en el que un usuario inicia sesión en un sistema que actúa como proveedor de identidad. El usuario desea iniciar sesión en una aplicación (el proveedor de servicios). Los pasos serían los siguientes:

\begin{enumerate}
	\item El usuario accede a la aplicación remota mediante un enlace en una intranet, un marcador o similar y se carga la aplicación.
	\item La aplicación identifica el origen del usuario (por subdominio de la aplicación, dirección IP del usuario o similar) y redirige al usuario al proveedor de identidad, solicitando la autenticación. Esta es la solicitud de autenticación.
	\item El usuario tiene una sesión de navegador activa existente con el proveedor de identidad o establece una, iniciando sesión en el proveedor de identidad.
	\item El proveedor de identidad construye la respuesta de autenticación en forma de un documento XML que contiene el nombre de usuario o la dirección de correo electrónico del usuario, lo firma con un certificado X.509 y publica esta información al proveedor de servicios.
	\item El proveedor de servicios, que ya conoce al proveedor de identidad y tiene una huella digital de certificado, recupera la respuesta de autenticación y la valida utilizando la huella digital del certificado.
	\item Se establece la identidad del usuario y se le proporciona acceso a la aplicación.
\end{enumerate}

\subsubsection{SAML 2.0}
\label{subsubsec:saml2}
SAML 2.0~\cite{anderson2004saml} es una versión del estándar SAML para tramitar el intercambio de datos de autenticación y autorización entre dominios de seguridad. Es un protocolo basado en XML que utiliza tokens de seguridad que contienen aserciones para pasar información sobre un principal (generalmente un usuario final) entre un Proveedor de Identidad, y un Proveedor de Servicios.

SAML 2.0 fue ratificado como un estándar OASIS en marzo de 2005, reemplazando a SAML 1.1.

\subsection{OpenID Connect}
\label{subsec:openidconnect}
OpenID Connect~\cite{sakimura2014openid} es un protocolo de autenticación implementada utilizando OAuth 2.0. El estándar está controlado por el OpenID Foundation. Permite a los clientes verificar la identidad del usuario final basándose en la autenticación realizada por un servidor de autorización, así como obtener información de perfil básica sobre el usuario final de manera interoperable y similar a REST.

OpenID Connect permite a los clientes de todo tipo, incluidos los clientes basados en web, móviles y de JavaScript, solicitar y recibir información sobre sesiones autenticadas y usuarios finales. El conjunto de especificaciones es extensible, lo que permite a los participantes utilizar funciones opcionales, como el cifrado de datos de identidad, el descubrimiento de proveedores de OpenID y la administración de sesiones, cuando sea conveniente para ellos.

Las especificaciones de OpenID Connect y las especificaciones en las que se basan se muestran en el diagrama a continuación:

\begin{figure}[H]
	\includegraphics[scale=1.8, center]{image/arqu_openid.png}
	\caption{OpenID Connect Protocol Suite}
	\label{figura:arqu_openid}
\end{figure}

\subsection{OAuth 2.0}
\label{subsec:seccion}
El estándar OAuth 2.0~\cite{hardt2012oauth} (RFC 6749)~\cite{hardt2012rfc} es un \emph{framework} de autorización que permite controlar el acceso por parte de las aplicaciones a los datos de los usuarios sin tener que proporcionar las credenciales. Según el estándar, el marco de autorización de OAuth 2.0 permite que una aplicación de terceros obtenga acceso limitado a un servicio HTTP, ya sea en nombre de un propietario de recursos mediante la organización de una interacción de aprobación entre el propietario del recurso y el servicio HTTP, o permitiendo a la aplicación de terceros obtener acceso en su propio nombre. 



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OBJETIVOS %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Objetivos} 
\label{chap:objetivos} 

\section{Objetivo general}
\label{sec:objetivo-general} 
%Aquí vendría el objetivo general en una frase:
%Mi trabajo fin de grado consiste en crear de una herramienta de análisis de los comentarios jocosos en repositorios de %software libre alojados en la plataforma GitHub.
%Recuerda que los objetivos siempre vienen en infinitivo.
Este trabajo fin de grado ha consistido en crear los mecanismos necesarios para la concesión de autorización entre una aplicación y una API a través de una implementación del estándar OAuth 2.0.

\section{Motivación}
\label{sec:motivacion} 
Desde que comencé a trabajar en el mundo de la ciberseguridad he ido adquiriendo conocimientos de las principales técnicas, protocolos y estándares que son utilizados actualmente por las empresas y los profesionales en la actualidad. El estándar OAuth 2.0 llamó mucho mi atención por lo bien construido que estaba y la cantidad de sitios en los que se utilizaba. Después de esto me empecé a informar y decidí convertir la implementación de este estándar en mi TFG.

\section{Objetivos específicos}
\label{sec:objetivos-especificos}
%Los objetivos específicos se pueden entender como las tareas en las que se ha desglosado el objetivo general.
%Y, sí, también vienen en infinitivo.
Los objetivos específicos del proyecto son los siguientes:
\begin{enumerate}
	\item Elaborar una propuesta de tecnología, arquitectura y límites del proyecto: Dicha propuesta respondería a la finalidad última del proyecto y pondría límites a los trabajos que se llevaría a cabo más adelante.
	\item En base a la arquitectura realizar un estudio e implementar el esquema de base de datos a utilizar: Las conclusiones obtenidas serán en base a las necesidades iniciales del primer estudio y teniendo en cuenta en la medida de lo posible mejoras futuras.
	\item Creación de la capa de \emph{front} de la aplicación: Esta web deberá disponer de las características necesarias para que se puedan realizar las  pruebas necesaria para el testeo de la aplicación. Se tendrán en cuenta características como establecer una interfaz amigable y \emph{responsive}.
	\item Administración del registro y login de usuarios en la aplicación: Creación de la funcionalidad específica para la correcta acción de registro y autenticación de usuarios en la aplicación, teniendo en cuenta diversas problemáticas que se puedan dar e intentar anticiparse, así como realizar el mejor control de errores posible.
	\item Creación del proceso de registro de aplicaciones en la aplicación: Creación de la funcionalidad específica de alta y baja de aplicaciones en la API. De esta forma la aplicación podrá solicitar acceso a los recursos de los usuarios a la API.
	\item Creación del proceso de autorización utilizando el estándar OAuth 2.0: Desarrollo de la funcionalidad específica del estándar OAuth 2.0 basándonos en la documentación establecida en la RFC 6749~\cite{hardt2012rfc}.
	\item Creación del \emph{front} básico de gestión de usuarios de la API: Dicha web deberá disponer de una interfaz simple que permita realizar la autenticación de un usuario en la API.
\end{enumerate}

\section{Metodología}
\label{sec:metodologia}
Este Trabajo Fin de Grado se ha realizado utilizando una metodología de realimentación o feedback basada en la metodología ágil SCRUM~\cite{beck2001manifesto}. 
Se basa en que el producto final es el resultado de su propia evolución como consecuencia de las mejoras y problemas que se han ido identificando durante la creación del mismo. En el siguiente esquema podemos observar las diferentes etapas en formación rotativa que se han tenido en cuenta:
%\newpage
\begin{figure}[H]
	\includegraphics[scale=0.7, center]{image/metodologia_ok.png}
	\caption{Esquema de las diferentes etapas}
	\label{figura:metodologia}
\end{figure}

En la figura \ref{figura:metodologia} podemos observar el flujo con las diferentes etapas que se ha seguido en el proyecto. 

La etapa que podemos considerar inicial ha sido la de 'Aprendizaje' en la cuál se estudió el protocolo y se dedujeron los componentes que serían necesarios para que el modelo general tuviera sentido. De la mano fueron 'Etapa de diseño' en la cuál se decidió en un primer momento de qué manera se iban a juntar las piezas, para que más tarde, en 'Etapa de desarrollo', tuviéramos claro qué herramientas eran las óptimas.
Una vez se tuvo una primera versión se continuó con la 'Realización de Pruebas' para comprobar el correcto funcionamiento del desarrollo y paralelamente se realizó una 'Evaluación del Producto'. Cuando ya se tuvo una idea general del producto parcialmente completo, se comparó con el resultado de la etapa 'Extracción de Requisitos' para, de esta forma, comprobar que se había logrado conseguir lo que se pretendía o aún faltaban cosas. En caso de que aún faltaran cosas se identificaban las diferencias obtenidas y se repetía el ciclo.

\clearpage

\section{Planificación temporal}
\label{sec:planificacion-temporal}
%A mí me gusta que aquí pongáis una descripción de lo que os ha llevado realizar el trabajo.
%Hay gente que añade un diagrama de GANTT.
%Lo importante es que quede claro cuánto tiempo llevas (tiempo natural, p.ej., 6 meses) y a qué nivel de esfuerzo (p.ej., %principalmente los fines de semana).

La duración de la realización del proyecto ha sido entorno a los 6.5 meses. A continuación se adjunta un diagrama de Gantt~\cite{chang2006system}:

\begin{figure}[H]
	\includegraphics[scale=0.4, center]{image/Diagr_Gantt_2.png}
	\caption{Diagrama de Gantt}
	\label{figura:diag_gantt}
\end{figure}

Tal y como se observa en la figura \ref{figura:diag_gantt}, desde el 15 de Junio hasta el 7 de Enero la estimación de horas que he necesitado para la finalización del proyecto ha sido entorno a las 400 horas. De ese total de horas la mayoría han sido en las horas posteriores a la vuelta de la jornada laboral y durante los fines de semana, siendo respectivamente la media de horas de 1 a 2 y de 4 a 14.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ESTADO DEL ARTE %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Estado del arte}
\label{chap:estadoArte} 
En este capítulo se expondrán las diferentes tecnologías y mecanismos utilizados durante la realización del proyecto. Alguno de ellos se han utilizado por disponer de conocimientos más profundos y ahorrarnos tiempo a la hora de llegar al objetivo final y otros por utilizar mecanismos nuevos y ampliar conocimientos.

\section{Tecnologías utilizadas} 
\label{sec:tecnologias}

\subsection{Java}
\label{subsec:java}
Java\footnote{\url{https://www.java.com/es/}} es un lenguaje de programación de propósito general, concurrente, orientado a objetos, que fue diseñado específicamente para tener tan pocas dependencias de implementación como fuera posible. Su intención es permitir que los desarrolladores de aplicaciones escriban el programa una vez y lo ejecuten en cualquier dispositivo (conocido en inglés como WORA, o 'write once, run anywhere'), lo que quiere decir que el código que es ejecutado en una plataforma no tiene que ser recompilado para correr en otra. \footnote{\url{https://www.oracle.com/technetwork/java/langenv-140151.html}}
El lenguaje Java se creó con cinco objetivos principales:
\begin{enumerate}
	\item Debería usar el paradigma de la programación orientada a objetos.
	\item Debería permitir la ejecución de un mismo programa en múltiples sistemas operativos.
	\item Debería incluir por defecto soporte para trabajo en red.
	\item Debería diseñarse para ejecutar código en sistemas remotos de forma segura.
	\item Debería ser fácil de usar y tomar lo mejor de otros lenguajes orientados a objetos, como C++.
\end{enumerate}

\subsection{PostgreSQL}
\label{subsec:postgres}
PostgreSQL\footnote{\url{https://www.postgresql.org/}} es un potente sistema de base de datos relacional de objetos de código abierto que utiliza y amplía el lenguaje SQL combinado con muchas características que almacenan y escalan de forma segura las cargas de trabajo de datos más complicadas.

PostgreSQL se ha ganado una sólida reputación por su arquitectura probada, confiabilidad, integridad de datos, conjunto de características sólidas, extensibilidad y la dedicación de la comunidad de código abierto detrás del software para ofrecer constantemente soluciones innovadoras y de alto rendimiento. PostgreSQL se ejecuta en todos los principales sistemas operativos.

\subsection{Gradle}
\label{subsec:gradle}
Gradle\footnote{\url{https://gradle.org/}} es una herramienta de automatización de compilación de código abierto centrada en la flexibilidad y el rendimiento. Los scripts de compilación de Gradle se escriben utilizando un DSL Groovy o Kotlin.
\begin{enumerate}
	\item Altamente personalizable: Gradle se modela de una manera que es personalizable y extensible de las formas más fundamentales.
	\item Rápido: Gradle completa las tareas rápidamente, reutilizando los resultados de ejecuciones anteriores, procesando solo las entradas que han cambiado y ejecutando tareas en paralelo.
	\item Potente: Gradle es la herramienta de compilación oficial para Android y es compatible con muchos lenguajes y tecnologías populares.
\end{enumerate}

\subsection{JavaScript}
\label{subsec:javaScript}
JavaScript\footnote{\url{https://developer.mozilla.org/es/docs/Web/JavaScript}} (abreviado comúnmente JS) es un lenguaje de programación interpretado, dialecto del estándar ECMAScript\footnote{\url{http://www.ecma-international.org/publications/standards/Ecma-262.htm}}. Se define como orientado a objetos,? basado en prototipos, imperativo, débilmente tipado y dinámico.

Se utiliza principalmente en su forma del lado del cliente (client-side), implementado como parte de un navegador web permitiendo mejoras en la interfaz de usuario y páginas web dinámicas, aunque existe una forma de JavaScript del lado del servidor (Server-side JavaScript o SSJS). Su uso en aplicaciones externas a la web, por ejemplo en documentos PDF, aplicaciones de escritorio (mayoritariamente widgets) es también significativo.

Tradicionalmente se venía utilizando en páginas web HTML para realizar operaciones y únicamente en el marco de la aplicación cliente, sin acceso a funciones del servidor. Actualmente es ampliamente utilizado para enviar y recibir información del servidor junto con ayuda de otras tecnologías como AJAX. JavaScript se interpreta en el agente de usuario al mismo tiempo que las sentencias van descargándose junto con el código HTML.

\subsection{JQuery}
\label{subsec:jquery}
jQuery\footnote{\url{https://jquery.com/}} es una biblioteca de JavaScript rápida, pequeña y con muchas funciones. Hace que cosas como la manipulación de documentos HTML, el manejo de eventos, la animación y Ajax sean mucho más simples con una API fácil de usar que funciona en una gran cantidad de navegadores. Con una combinación de versatilidad y extensibilidad, jQuery ha cambiado la forma en que millones de personas escriben JavaScript.

\subsection{Ajax}
\label{subsec:ajax}
Ajax\footnote{\url{https://web.archive.org/web/20080413132458/http://www.librosweb.es/ajax/index.html}} acrónimo de Asynchronous JavaScript And XML~\cite{eernisse2006build} (JavaScript asíncrono y XML), es una técnica de desarrollo web para crear aplicaciones interactivas o RIA (Rich Internet Applications). Estas aplicaciones se ejecutan en el cliente, es decir, en el navegador de los usuarios mientras se mantiene la comunicación asíncrona con el servidor en segundo plano. De esta forma es posible realizar cambios sobre las páginas sin necesidad de recargarlas, mejorando la interactividad, velocidad y usabilidad en las aplicaciones.

Ajax es una tecnología asíncrona, en el sentido de que los datos adicionales se solicitan al servidor y se cargan en segundo plano sin interferir con la visualización ni el comportamiento de la página, aunque existe la posibilidad de configurar las peticiones como síncronas de tal forma que la interactividad de la página se detiene hasta la espera de la respuesta por parte del servidor.

JavaScript es un lenguaje de programación (scripting language) en el que normalmente se efectúan las funciones de llamada de Ajax mientras que el acceso a los datos se realiza mediante XMLHttpRequest, objeto disponible en los navegadores actuales. En cualquier caso, no es necesario que el contenido asíncrono esté formateado en XML.

Ajax es una técnica válida para múltiples plataformas y utilizable en muchos sistemas operativos y navegadores dado que está basado en estándares abiertos como JavaScript y Document Object Model (DOM).

\subsection{Bootstrap}
\label{subsec:bootstrap}
Bootstrap\footnote{\url{https://getbootstrap.com/}} es una biblioteca multiplataforma o conjunto de herramientas de código abierto para diseño de sitios y aplicaciones web. Contiene plantillas de diseño con tipografía, formularios, botones, cuadros, menús de navegación y otros elementos de diseño basado en HTML y CSS, así como extensiones de JavaScript adicionales. A diferencia de muchos \emph{frameworks} web, solo se ocupa del desarrollo \emph{front-end}.

Bootstrap es el segundo proyecto más destacado en GitHub y es usado por la NASA y la MSNBC entre otras organizaciones.

Es interesante el tratamiento web que se obtiene al utilizar Bootstrap, ya que por defecto cualquier página que se realice dispondrá de diseño web \emph{responsive} o adaptativo que es una técnica de diseño web que busca la correcta visualización de una misma página en distintos dispositivos.

\subsection{REST}
\label{subsec:rest}
La transferencia de estado representacional (en inglés representational state transfer) o REST, es un estilo de arquitectura software para sistemas hipermedia distribuidos como la World Wide Web.


\section{Acceso al software del proyecto}
\label{sec:accesoSoftware}
Todo el código fuente del proyecto se encuentra disponible en GitHub en la dirección  \href{https://github.com/Xevit/eclipse-workspace}{https://github.com/Xevit/eclipse-workspace}.
También se puede acceder al repositorio de la memoria a través del siguiente enlace \href{https://github.com/Xevit/Memo}{https://github.com/Xevit/Memo}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DISEÑO %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Diseño}

En este capítulo se describe detalladamente el proceso de diseño que se ha seguido para la realización del proyecto. 

\section{Protocolo abstracto de flujo} 
\label{sec:abstract_flow}

Para entender las decisiones que se han tomado durante la realización del proyecto es necesario que primero identifiquemos las características del protocolo OAuth 2.0. Dicho protocolo define cuatro roles~\cite{anicas2014introduction}:

\begin{itemize}
	\item Propietario del recurso: Usuario que autoriza a una aplicación para acceder a su cuenta. El acceso de la aplicación a la cuenta del usuario está limitado al 'alcance' de la autorización otorgada (por ejemplo lectura/escritura).
	\item Cliente: Aplicación que quiere acceder a la cuenta del usuario. Antes de que pueda hacerlo deber ser autorizado por el usuario, y la autorización debe ser validada por la API.
	\item Servidor de recursos/Servidor de Autorización: El servidor de recursos aloja las cuentas de usuario protegidas, y el servidor de autorización verifica la identidad del usuario y luego emite tokens de acceso a la aplicación.  
\end{itemize}

El diagrama de la figura \ref{figura:abstract_flow} muestra un protocolo abstracto de flujo:

%www.draw.io
\begin{figure}[H]
	\includegraphics[scale=0.8, center]{image/Flujo_Abstracto.png}
	\caption{Flujo Abstracto}
	\label{figura:abstract_flow}
\end{figure}

En el flujo de protocolo abstracto anterior \ref{figura:abstract_flow}, los primeros cuatro pasos cubren la obtención de una concesión de autorización y un token de acceso. El tipo de concesión de autorización depende del método utilizado por la aplicación para solicitar la autorización y los tipos de concesión admitidos por la API. OAuth 2.0 define cuatro tipos de concesión:

\begin{itemize}
	\item Código de autorización: utilizado con aplicaciones del lado del servidor.
	\item Implícito: se utiliza con aplicaciones móviles o aplicaciones web (aplicaciones que se ejecutan en el dispositivo del usuario).
	\item Credenciales de contraseña del propietario del recurso: se utilizan con aplicaciones de confianza, como las que son propiedad del propio servicio.
	\item Credenciales del cliente: utilizadas con el acceso a la API de aplicaciones.
\end{itemize}

\section{Tipo de concesión elegida: Código de autorización} 
\label{sec:codigo_autorizacion}

El tipo de concesión de código de autorización es el más comúnmente usado porque está optimizado para aplicaciones del lado del servidor, donde el código fuente no se expone públicamente y se puede mantener la confidencialidad del secreto del cliente. Este es un flujo basado en la redirección, lo que significa que la aplicación debe ser capaz de interactuar con el 'agente del usuario' (es decir, el navegador web del usuario) y recibir códigos de autorización API que se enrutan a través del agente del usuario.

El siguiente punto 'Arquitectura general', pasa a describir los desarrollos mediante los flujos e interacciones entre los diferentes roles que se han realizado en este proyecto.

\section{Arquitectura general} 
\label{sec:arquitectura}
%%Arquitectura general de mi proyecto. Modulos con BBDD, gráficamente. Clases que tiene el proyecto y para qué sirve cada una de ellas.
Para que se pueda tener en mente la arquitectura que finalmente ha tenido el proyecto se ha dividido el mismo en tres partes, cada una de las cuales hace referencia a las tres partes importantes que anteriormente enumeramos:
\begin{enumerate}
	\item Administración del registro y login de usuarios en la aplicación: 
	\begin{itemize}
		\item Partes implicadas $\rightarrow$ \textbf{Aplicación - Usuario}.
		\item Mediante este desarrollo se conseguirá disponer de un servicio de gestión de acceso a usuarios.
		\item Las opciones consistirán en una pestaña para realizar el acceso (loguin) y otra pestaña para llevar a cabo el registro de un nuevo usuario.
		\item No podrán existir dos usuarios con el mismo nombre.
	\end{itemize}
	\item Creación del proceso de registro de aplicaciones en la Aplicación: Creación de la funcionalidad específica de alta y baja de aplicaciones en la API:
	\begin{itemize}
		\item Partes implicadas $\rightarrow$ \textbf{Aplicación - API}.
		\item Funcionalidad a la que únicamente tendrá acceso el usuario administrador.
		\item Consistirá en el desarrollo de dos botones. Uno de ellos tendrá la capacidad de realizar el proceso de comunicación entre la aplicación y la API para registrar dicha aplicación en la lista de confianza de la API.
		\item El segundo botón tendrá la capacidad de realizar el proceso de comunicación entre la aplicación y la API para eliminar nuestra aplicación de la lista de confianza de la API. Este botón se usará en el caso en el que no queramos que nuestra aplicación figure en la lista de confianza de la API.
	\end{itemize}
	\item Creación del proceso de autorización utilizando el estándar OAuth 2.0: Desarrollo de la funcionalidad específica del estándar OAuth 2.0 basándonos en la documentación establecida en la RFC 6749~\cite{hardt2012rfc}: 
	\begin{itemize}
		\item Partes implicadas $\rightarrow$ \textbf{Aplicación - Usuario - API}.
		\item Esta funcionalidad funcionará correctamente solamente en caso de que previamente hayamos dado de alta nuestra aplicación en la lista de confianza de la API (ver punto 2).
		\item Consistirá en la creación de un botón que desarrolle la funcionalidad completa del protocolo OAuth 2.0.
		\item Dentro de los pasos necesarios para la correcta ejecución del protocolo se encuentra la de mostrar una ventana para que el usuario se autentique contra la plataforma de la API. En caso de no estar dado de alta previamente en dicha API u obtener una autenticación fallida el proceso completo dará error y no se obtendrá token de acceso.
	\end{itemize}
\end{enumerate}

En el siguiente capítulo de implementación desarrollaremos cada una de estas tres partes.

\section{Arquitectura de BBDD} 
\label{sec:arquitectura_bbdd}

La arquitectura de base de datos(BBDD) consta de dos partes diferenciadas. Por un lado tenemos las tablas de la BBDD de la aplicación (REDOA2) y por otro lado las tablas de la API (APIOA2). 

%Aquí voy a hacer un diagrama entidad relación. 
[DIAGRAMA ENTIDAD RELACIÓN]

\subsection{Base de datos de la aplicación}
\label{sec:bbdd_aplicacion}
Va a constar de las tablas:
\begin{enumerate}
	\item REDOA2\_USERS:
	\item REDOA2\_APPLICATION\_REQUEST:
	\item REDOA2\_APPLICATION\_RECORD:
\end{enumerate}

\subsection{Base de datos de la API}
\label{sec:bbdd_api}
\begin{enumerate}
	\item APIOA2\_USERS:
	\item APIOA2\_APPLICATION\_REQUEST:
	\item APIOA2\_APPLICATION\_RECORD:
	\item APIOA2\_AUTHORIZATION\_BASE:
\end{enumerate}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% IMPLEMENTACION %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Implementación}

Después de realizar el estudio del protocolo RFC 6749~\cite{hardt2012rfc}, de haber identificado cada una de los tipos de concesión permitidas y de explicar la elección que se ha realizado, en el siguiente capítulo entraremos en profundidad en cada una de las partes en las que se ha dividido la implementación.

\section{Registro y login de usuarios en la aplicación}
\label{sec:apli-user}
\begin{figure}[H]
	\includegraphics[scale=0.7, center]{image/Implement_1.png}
	\caption{Registro y Login}
	\label{figura:registroLogin}
\end{figure}

En esta primera parte, tal y como se observa en la imagen \ref{figura:registroLogin} se puede observar que existen dos flujos que relacionan a la aplicación con el usuario. El primero (1) es el login de usuarios y el segundo (2) es el registro de usuarios en la aplicación. Las siguientes secciones desgranan cada uno de los dos procesos (el proceso de login y el proceso de registro) mostrando el \emph{front} de la aplicación, para finalmente de forma conjunta mostrar los flujos de código.

\subsection{Login}
\label{subsec:login}
El proceso completo de login de un usuario sería el siguiente:
\begin{figure}[H]
	\includegraphics[scale=0.68, center]{image/5_1_1_Login_1.PNG}
	\caption{Login First Step}
	\label{figura:login_1}
\end{figure}
Esta figura consiste en la página web principal. Se puede ver un resumen de lo que es el protocolo OAuth 2.0 y un botón mediante el cuál se accederá  a la página principal del estándar. Arriba a la izquierda se dispone del botón 'Home' para volver a la página principal. Arriba a la derecha se tendrán los botones 'Login/Register' mediante los cuales se accederá a una nueva página que dispondrá de la capacidad de acceso a la aplicación.

Abajo se pueden observar iconos de las diferentes Redes Sociales (RRSS). Aquellos que estén en azul redireccionarán a la página personal del creador de este proyecto, en la RRSS específica.  Estos iconos, junto con el 'Copyright' se ha establecido de esta manera para dar un aspecto atractivo y de empaque a la página principal.\\


\begin{figure}[H]
	\includegraphics[scale=0.65, center]{image/5_1_1_Login_2.PNG}
	\caption{Login Second Step}
	\label{figura:login_2}
\end{figure}

Una vez se redireccione a la pantalla de acceso, se dispondrá de dos pestañas. En la primera tendremos el 'Login', mediante el cuál, después de escribir un nombre de usuario y contraseña dado de alta en la aplicación, se nos redireccionará a la página principal.

En caso de pulsar la pestaña 'Register' se accederá a un formulario que se deberá rellenar para dar de alta un nuevo usuario en la aplicación. En caso de que se intente acceder con un usuario que previamente estuviera dado de alta en la plataforma se indicará.

\clearpage
\begin{figure}[H]
	\includegraphics[scale=0.55, center]{image/5_1_1_Login_3_OK.PNG}
	\caption{Login Third Step OK}
	\label{figura:login_3}
\end{figure}

En caso de que la autenticación haya sido correcta se redirigirá a la pantalla principal \ref{figura:login_3} mostrándose en la parte superior derecha el usuario con el que se haya autenticado en la aplicación y se abrirá una nueva opción, 'Grant authorization' para comenzar con el proceso de autorización de recursos.

\clearpage
\begin{figure}[H]
	\includegraphics[scale=0.42, center]{image/5_1_1_Login_3_OK_admin.PNG}
	\caption{Login Third Step OK Admin}
	\label{figura:login_4}
\end{figure}

En caso de que se haya realizado el acceso utilizando para ello el usuario 'admin' \ref{figura:login_4}, además de disponer de la pestaña de 'Grant authorization' se tendrán las pestañas de 'Alta en API' y 'Baja en API'.

\begin{figure}[H]
	\includegraphics[scale=0.4, center]{image/5_1_1_Login_3_KO.PNG}
	\caption{Login Third Step KO}
	\label{figura:login_5}
\end{figure}

En caso que el nombre de usuario o contraseña sean incorrectos aparecerá el mensaje 'El nombre de usuario o contraseña no es correcto'.

\begin{figure}[H]
	\includegraphics[scale=0.6, center]{image/5_1_1_Login_4.PNG}
	\caption{Login Fourth Step}
	\label{figura:login_6}
\end{figure}

En caso de querer salir de la aplicación se deberá pulsar el botón de 'Logout' y se nos informará, mediante el mensaje modal 'Se ha deslogueado correctamente.' que se ha realizado correctamente el logout.

\clearpage
\subsection{Registro}
\label{subsec:registro}
El proceso completo de registro de un usuario sería el siguiente:

\begin{figure}[H]
	\includegraphics[scale=0.6, center]{image/5_1_1_Login_1.PNG}
	\caption{Register First Step}
	\label{figura:register_1}
\end{figure}

En esta figura se puede ver la web principal de la aplicación. Para acceder al registro se deberá pulsar sobre el botón 'Login/Register' en la parte superior derecha de la figura.

\clearpage
\begin{figure}[H]
	\includegraphics[scale=0.5, center]{image/5_1_2_Registro_1.PNG}
	\caption{Register Second Step}
	\label{figura:register_2}
\end{figure}

Se nos redigirá a la pantalla de autenticación \ref{figura:register_2} o registro donde si pulsamos a la pestaña de 'Register' se podrá realizar un registro de usuario en la aplicación. Para ello se deberá rellenar el 'Username', el 'Email Address', la 'Password' y será necesario rellenar el 'Confirm Password' para confirmar la password.

\begin{figure}[H]
	\includegraphics[scale=0.45, center]{image/5_1_2_Registro_2_OK.PNG}
	\caption{Register Third Step}
	\label{figura:register_3}
\end{figure}

En caso de que el registro sea exitoso se obtendrá un mensaje indicando que el proceso se ha realizado satisfactoriamente \ref{figura:register_3}.

\begin{figure}[H]
	\includegraphics[scale=0.55, center]{image/5_1_2_Registro_2_KO.PNG}
	\caption{Register Fourth Step}
	\label{figura:register_4}
\end{figure}

En caso de que el nombre que se intente dar de alta ya se encuentre registrado en la plataforma se obtendrá el mensaje de error 'El usuario ya existe' indicando que el usuario ya estaba dado de alta previamente \ref{figura:register_4}.

\clearpage
\subsection{Flujos de código}
\label{subsec:codigoUno}

La página principal se encuentra en el archivo \textit{index.html}. Al hacer click en el botón 'Login/Register' se redirecciona al JSP \textit{login.jsp}. Este JSP tiene cargado un script llamado \textit{ajax\_json\_log.js} con dos funciones Ajax. La primera de ellas se activará al realizar el login y la segunda al realizar el registro.

\begin{enumerate}
	\item La primera redireccionará a la URL \textbf{/login\_usuario} que estará gestionada por la clase \textit{LoginServlet.java}. En esta clase se comprobará que exista el usuario y contraseña que nos envían. Para comprobar la existencia del usuario se llamará al método de la clase \textit{DAOLogin.existUser}:
	\begin{enumerate}
		\item En caso de existir se creará una cookie (básica) para la persistencia de la sesión y se devolverá la resolución de la clase al archivo \textit{ajax\_json\_log.js}. Este redireccionará a la página principal. En la clase principal se podrá observar como se dispone de una sesión abierta con el usuario logueado además de tener disponible los botones de interacción con la aplicación. En caso de haberse realizado el login con el usuario 'admin' se dispondrá de los botones de Alta y Baja de Aplicaciones en la API.
		\item En caso de no existir se devolverá la resolución de la clase al archivo \textit{ajax\_json\_log.js}. Este mostrará un mensaje indicando que el usuario y/o contraseña no son válidos.
	\end{enumerate}
	\item La segunda redireccionará a la URL \textbf{/registra\_usuario} que estará gestionada por la clase \textit{RegisterServlet.java}. En esta clase se comprobará que el usuario no existe a través del método de la clase \textit{DAORegistro.existUser}:
	\begin{enumerate}
		\item En caso de que el usuario ya exista se finalizará el hilo de la clase y se devolverá la resolución al archivo \textit{ajax\_json\_log.js}. Este mostrará un mensaje indicando que el usuario que se está intentando dar de alta ya existe en la Aplicación.
		\item En caso de que el usuario no exista se realizará una llamada al método de la clase \textit{DAORegistro.setUser} para que realice una inserción en BBDD de todos los campos que ha facilitado el usuario. Posteriormente finalizará el hilo de la clase y se devolverá la resolución al archivo \textit{ajax\_json\_log.js}. Este mostrará un meensaje indicando que el usuario ha sido creado satisfactoriamente.
	\end{enumerate}
\end{enumerate}

\clearpage
\section{Registro de aplicaciones en la aplicación}
\label{sec:api-user}

Para que podamos utilizar el protocolo OAuth 2.0 previamente se tiene que cumplir el paso de que la aplicación que quiere solicitar recursos de un usuario en la API, esté dado de alta en dicha API. 

En este punto entraremos en detalle en el registro de aplicaciones en la API así como la baja de dichas aplicaciones.

\subsection{Alta de aplicaciones}
\label{subsec:altaAPI}
\begin{figure}[H]
	\includegraphics[scale=0.6, center]{image/Implement_2.png}
	\caption{Alta en API}
	\label{figura:altaAplicaciones}
\end{figure}

Este esquema \ref{figura:altaAplicaciones} muestra el alta de la Aplicación en la API. Los diferentes pasos que se dan hasta llegar a dicho propósito serían los siguientes:

\begin{enumerate}
	\item Se manda correo electrónico a la API para comenzar el proceso de alta. En dicho correo se deberá enviar la URL desde la cuál se va a hacer la petición de alta.
	\item La API responde al correo electrónico enviando también un mail con un código en Base64. De esta forma se indicará que la aplicación cumple los requisitos impuestos por la API.
	\item Se carga el código en Base64 en la aplicación.
	\item Se manda la primera solicitud directa entre aplicación y API. Dicha solicitud se realizará mediante REST y llevará en la URL la aplicación que la realiza, así como el código en Base64.
	\item La API lee la URL y va a buscar en su BBDD si existe alguna aplicación dada de alta que corresponda con los datos que se le mandan en la petición.
		\begin{enumerate}
			\item En caso de que la aplicación ya estuviera dada de alta se enviará un mensaje de vuelta a la aplicación indicando que ya estaba dada de alta. 
			\item En caso de que la aplicación no estuviera dada de alta en la API se generará un código \textbf{CLIENT\_ID} y un código \textbf{CLIENT\_SECRET}. Se almacenará en la BBDD de la API toda la información correspondiente a la misma y se responderá indicando que dicha aplicación no estaba dada de alta en la API y facilitándole los dos códigos generados.
		\end{enumerate}
	\item En la parte de la aplicación se nos indicará el resultado del proceso del alta:
	\begin{enumerate}
		\item El siguiente mensaje \ref{figura:altaAplicacionesOK} es el que se obtendrá en caso de que el alta se haya realizado correctamente.
		\begin{figure}[H]
			\includegraphics[scale=0.6, center]{image/5_2_1_AltaAPI_OK.PNG}
			\caption{Alta en API - Alta correcta}
			\label{figura:altaAplicacionesOK}
		\end{figure}
		\item El siguiente mensaje \ref{figura:altaAplicacionesKO} se obtendrá en caso de que la aplicación ya estuviera dada de alta en la API.
		\begin{figure}[H]
			\includegraphics[scale=0.6, center]{image/5_2_1_AltaAPI_KO.PNG}
			\caption{Alta en API - Alta ya realizada}
			\label{figura:altaAplicacionesKO}
		\end{figure}
	\end{enumerate}
	\item Para finalizar, en caso de que la aplicación no estuviera dada de alta se almacenarán los datos facilitados por la API en la BBDD de la aplicación.
\end{enumerate}

\clearpage
\subsection{Baja de aplicaciones}
\label{subsec:bajaAPI}
\begin{figure}[H]
	\includegraphics[scale=0.6, center]{image/Implement_2_2.png}
	\caption{Baja en API}
	\label{figura:bajaAplicaciones}
\end{figure}

Este esquema \ref{figura:bajaAplicaciones} muestra la baja de la aplicación en la API. Los diferentes pasos que se dan hasta llegar a dicho propósito serían los siguientes:

\begin{enumerate}
	\item Se manda una solicitud directa desde la aplicación a la API. Dicha solicitud se realizará mediante REST y llevará en la URL la aplicación que la realiza, así como el código inicial en Base64.
	\item La API lee la URL y va a buscar en su BBDD si existe alguna aplicación dada de alta que corresponda con los datos que se le mandan en la petición.
		\begin{enumerate}
			\item En caso de que la aplicación estuviera dada de alta se borrará de la BBDD de la API toda la información correspondiente a la misma y se responderá indicando que dicha aplicación estaba dada de alta en la API.
			\item En caso de que la aplicación no estuviera dada de alta se responderá indicando que dicha aplicación no estaba dada de alta en la API.
		\end{enumerate}
	\item En la parte de la aplicación se nos indicará el resultado del proceso de baja:
		\begin{enumerate}
			\item El siguiente mensaje \ref{figura:bajaAplicacionesOK} es el que se obtendrá en caso de que la baja se haya realizado correctamente.
			\begin{figure}[H]
				\includegraphics[scale=0.6, center]{image/5_2_2_BajaAPI_OK.PNG}
				\caption{Baja en API - Baja correcta}
				\label{figura:bajaAplicacionesOK}
			\end{figure}
			\item El siguiente mensaje \ref{figura:bajaAplicacionesKO} se obtendrá en caso de que la baja no se haya podido realizar porque la aplicación no estuviera dada de alta en la API.
			\begin{figure}[H]
				\includegraphics[scale=0.6, center]{image/5_2_2_BajaAPI_KO.PNG}
				\caption{Baja en API - Baja no posible}
				\label{figura:bajaAplicacionesKO}
			\end{figure}
		\end{enumerate}
	\item Para finalizar, en caso de que la aplicación estuviera dada de alta se borrarán los datos relativos a este registro en la BBDD de la aplicación.
\end{enumerate}

\clearpage
\subsection{Flujos de código}
\label{subsec:codigoDos}

\subsubsection{Alta en API}
\label{subsubsec:codigoAlta}

\begin{enumerate}
	\item Se llama al archivo \textit{apiModal.js} que tendrá una función Ajax mediante la cuál mandaremos un mensaje POST al recurso \textbf{ApplicationOAuth2/AltaEnAPI} que se encuentra en la clase \textit{ApplicationRegistering.java} de la Aplicación.
	\item Desde la clase \textit{ApplicationRegistering.java} se llamará a la siguiente URL mediante mensaje GET: \\
	\href{}{\texttt{}}
	\href{http://localhost:8080/APIOAuth2/Register?url\_redirect=http://localhost:8080/ApplicationOAuth2/AltaEnAPI/Confiramation?code\_secret=[CODE\_SECRET]}{\texttt{http://localhost:8080/APIOAuth2/Register? url\_redirect=http:\linebreak //localhost:8080/ApplicationOAuth2/AltaEnAPI/Confiramation?\linebreak code\_secret=[CODE\_SECRET]}}
	\item La anterior URL será manejada por la clase \textit{ListenerRegistrationRequest.java} de la API que llamará al método \textit{DAORegisterApplication.existApp} para comprobar si existe o no la aplicación.
		\begin{enumerate}
			\item Si la aplicación ya estaba dada de alta, se enviará el siguiente mensaje GET:\\
			\href{http://localhost:8080/ApplicationOAuth2/AltaEnAPI/Confirmation?exist=true}{\texttt{http://localhost:8080/ApplicationOAuth2/AltaEnAPI/\linebreak Confirmation?exist=true}}
			\item Si la aplicación no estaba dada de alta:
				\begin{enumerate}
					\item Se llama a la clase \textit{RandomStringGenerator.java} para generar el CLIENT\_ID y el CLIENT\_SECRET.
					\item Se llama al método \textit{DAORegisterApplication.registerApplication} para almacenar todos los valores en la BBDD de la API.
					\item Se envia el siguiente mensaje GET:\\
					\href{http://localhost:8080/ApplicationOAuth2/AltaEnAPI/
						Confirmation?exist=false\&clientId=[CLIENT\_ID]\&clientSecret=[CLIENT\_SECRET]\&url\_redirect=http://localhost:8080/APIOAuth2}{\texttt{http://localhost:8080/ApplicationOAuth2/AltaEnAPI/\linebreak Confirmation?exist=false\&clientId=[CLIENT\_ID]\&\linebreak clientSecret=[CLIENT\_SECRET]\&url\_redirect=http://\linebreak localhost:8080/APIOAuth2}}
				\end{enumerate}	
		\end{enumerate}
	\item Tanto la respuesta de que la clase ya estaba creada como la de que no estaba creada se manejarán desde el recurso \textbf{ApplicationOAuth2/AltaEnAPI} en el método que maneja las peticiones GET de la clase \textit{ApplicationRegistering.java}. 
		\begin{enumerate}
			\item En caso de que la aplicación ya estuviera creada, se mostrará el siguiente mensaje, 'La aplicación ya estaba dada de alta en la API'.
			\item En caso de que la aplicación no estuviera dada de alta:
				\begin{enumerate}
					\item Se llamará al método \textit{DAORegisterApplication.registerApplication} para almacenar todos los valores en la BBDD de la aplicación.
					\item Se mostrará el siguiente mensaje, 'La aplicación se ha dado de alta correctamente en la API'.
				\end{enumerate}
		\end{enumerate}
\end{enumerate}

\subsubsection{Baja en API}
\label{subsubsection:codigoBaja}

\begin{enumerate}
	\item Se llama al archivo \textit{apiModal.js} que tendrá una función Ajax mediante la cuál mandaremos un mensaje POST al recurso \textbf{ApplicationOAuth2/BajaEnAPI} que se encuentra en la clase \textit{ApplicationUnsubscribe.java} de la Aplicación.
	\item Desde la clase \textit{ApplicationUnsubscribe.java} se llamará a la siguiente URL mediante mensaje GET: \\
	\href{}{\texttt{}}
	\href{http://localhost:8080/APIOAuth2/Unsubscribe?url_redirect=http://localhost:8080/ApplicationOAuth2/BajaEnAPI/Confirmation?code\_secret=[CODE\_SECRET]}{\texttt{http://localhost:8080/APIOAuth2/Unsubscribe?url\_redirect=\linebreak http://localhost:8080/ApplicationOAuth2/BajaEnAPI/\linebreak Confirmation?code\_secret=[CODE\_SECRET]}}
	\item La anterior URL será manejada por la clase \textit{ListenerUnsubscribeRequest.java} de la API que llamará al método \textit{DAOUnsubscribeApplication.existApp} para comprobar si existe o no la aplicación.
		\begin{enumerate}
			\item Si la aplicación estaba dada de alta:
				\begin{enumerate}
					\item  Se llama al método \textit{DAOUnsubscribeApplication.unsubscribeApplication} para eliminar todos los valores en la BBDD de la API.
					\item Se envía el siguiente mensaje GET:\\
					\href{http://localhost:8080/ApplicationOAuth2/BajaEnAPI/Confirmation?exist=true&url_redirect=http://localhost:8080/APIOAuth2}{\texttt{http://localhost:8080/ApplicationOAuth2/BajaEnAPI/\linebreak Confirmation?exist=true\&url\_redirect=http://localhost\linebreak :8080/APIOAuth2}}
				\end{enumerate} 
			\item Si la aplicación no estaba dada de alta, se enviará el siguiente mensaje GET: \\
			\href{}{\texttt{}}
			\href{http://localhost:8080/ApplicationOAuth2/BajaEnAPI/Confirmation?exist=false}{\texttt{http://localhost:8080/ApplicationOAuth2/BajaEnAPI/Confirmation\linebreak ?exist=false}}
		\end{enumerate}
	\item Tanto la respuesta de que la clase ya estaba creada como la de que no estaba creada se manejarán desde el recurso \textbf{ApplicationOAuth2/BajaEnAPI} en el método que maneja las peticiones GET de la clase \textit{ApplicationUnsubscribe.java}.
		\begin{enumerate}
			\item En caso de que la aplicación estuviera dada de alta:
				\begin{enumerate}
					\item Se llamará al método \textit{DAOUnsubscribeApplication.java} para eliminar todos los valores de dicho registro en la BBDD de la aplicación. 
					\item Se mostrará el siguiente mensaje, 'La aplicación se ha dado de baja en la API'.
				\end{enumerate}	
			\item En caso de que la aplicación no estuviera dada de alta en la API, se mostrará el siguiente mensaje, 'La aplicación no está dada de alta en la API'.
		\end{enumerate}
\end{enumerate}

\clearpage
\section{Proceso de autorización utilizando el estándar OAuth 2.0}
\label{sec:apli-user-api}
A continuación explicamos el proceso de autorización de OAuth 2.0 haciendo referencia a los pasos indicados en 
la figura con números:

\begin{figure}[H]
	\includegraphics[scale=0.6, center]{image/Implement_3.png}
	\caption{Proceso de Autorización}
	\label{figura:oAuthImplementado}
\end{figure}

Este esquema \ref{figura:oAuthImplementado} va a ayudar a entender todo el proceso de la concesión de autorización. Desde que se realiza la petición en la aplicación hasta que terminamos obteniendo las credenciales necesarias.

\begin{enumerate}
	\item Se hace click en el botón 'Grant' de la pantalla principal de la aplicación. Se mandará una petición a la API de solicitud de concesión de autorización. En dicha petición se indicará el \textbf{CLIENT\_ID} y la url de redirección.
	\begin{figure}[H]
		\includegraphics[scale=0.35, center]{image/5_1_1_Login_3_OK.PNG}
		\caption{Página principal}
		\label{figura:oAuth2_1}
	\end{figure}
	\item La API gestionará dicha solicitud y buscará en su BBDD si la aplicación que está generando dicha solicitud está dada de alta en la API. 
		\begin{enumerate}
			\item En caso de que exista se seguirá con el proceso.
			\item En caso contrario se lanzará la siguiente ventana \ref{figura:oAuth2_2}, indicando que la aplicación no dispone de permisos para la petición que está lanzando, tal y como se muestra en la siguiente imagen:
			\begin{figure}[H]
				\includegraphics[scale=0.40, center]{image/5_3_Web_API_KO.PNG}
				\caption{La aplicación no dispone de permisos}
				\label{figura:oAuth2_2}
			\end{figure}
		\end{enumerate}
	\clearpage
	\item En caso de estar dada de alta en la API se lanzará una web de login \ref{figura:oAuth2_3} mediante la cuál el usuario que está intentando dar autorización a la aplicación se autenticará. 
	\begin{figure}[H]
		\includegraphics[scale=0.6, center]{image/5_3_Web_API.PNG}
		\caption{Web de login para el usuario}
		\label{figura:oAuth2_3}
	\end{figure}
	\item Se devolverá a la API un formulario con el usuario y contraseña.
	\item La API comprobará buscando en su BBDD si el usuario que está intentando hacer login, existe. En caso de que exista se generará el \textbf{AUTHORIZATION\_CODE} y se almacenará en la BBDD junto con el \textbf{CLIENT\_ID}.
	\item En caso de que el usuario exista la API realizará una redirección a la aplicación enviando el \textbf{CLIENT\_ID} de la aplicación y el \textbf{AUTHORIZATION\_CODE}.
	\item En caso de que la aplicación identifique, en la URL de respuesta, el \textbf{CLIENT\_ID} se gestionará dicha petición y almacenará en su BBDD los datos recibidos. 
	\item Se continuará con el proceso de concesión de autorización y esta vez la aplicación enviará en la URL, el \textbf{CLIENT\_ID}, el \textbf{CLIENT\_SECRET} y el \textbf{AUTHORIZATION\_CODE} que se acaban de obtener.
	\item La API gestionará la petición entrante y en caso de que la petición obtenida sea correcta, generará un \textbf{ACCESS\_TOKEN} y almacenará todos los datos correpondientes a dicho proceso en su BBDD.
	\item Se realizará un último envío desde la API que contendrá un JSON con los datos correspondientes al proceso de concesión de autorización correcta entre los que se encontrarán:
		\begin{enumerate}
			\item \textbf{ACCESS\_TOKEN}: Token de acceso proporcionado por la API. 
			\item \textbf{TOKEN\_TYPE}: Token de tipo 'bearer' que indica que dicho token es un token de actualización y que se podrá utilizar para solicitar un nuevo token en el momento en el que se caduque el \textbf{ACCESS\_TOKEN}.
			\item \textbf{EXPIRES\_IN}: Tiempo de expiración del Token.
			\item \textbf{REFRESH\_TOKEN}: Token de actualización que servirá para solicitar un nuevo \textbf{ACCESS\_TOKEN} en el momento en que se supere el \textbf{EXPIRES\_IN}.
			\item \textbf{SCOPE}: Alcance de los permisos que se han obtenido. En este caso se instanciará a 'read'.
		\end{enumerate}
	\item Finalmente, para concluir el proceso de concesión de autorización, la aplicación almacenará en su BBDD todos los datos enviados por la API.
\end{enumerate}

De esta forma la aplicación conseguirá obtener las credenciales de acceso necesarias para poder realizar consultas a la API y de poder acceder a la información del usuario que se encuentre dentro del rango de autorización establecido (en este caso solo se dispondrían de permisos para leer).

\clearpage
\subsection{Flujos de código}
\label{subsec:codigoTres}
\begin{enumerate}
	\item Se pulsa el botón 'Grant' dentro de la página \textit{index.html} que se gestionará en \textbf{ApplicationOAuth2/GrantAuthorization} dentro del método \textit{ApplicationGrant.doGet()}. Se preparará la redirección con la siguiente URL:\\
	\url{http://localhost:8080/APIOAuth2/GrantAuthorization/FirstStep?response_type=code&client_id=[CLIENT_ID]&redirect_uri=http://localhost:8080/ApplicationOAuth2/ResponseAuthorization&scope=read}
	\item El método \textit{ListenerGrant.doGet()} será el encargada de analizar la respuesta y solo se analizará si el \textbf{response\_type} es del tipo \textbf{code}. Se comprobará que la aplicación está dada de alta en la API a través del método \textit{DAOSearchApplication.existApp}.
		\begin{enumerate}
			\item En caso de que sí esté dada de alta, se redireccionará a la página:\\
			\href{http://localhost:8080/APIOAuth2/login.jsp?client_id=[CLIENT_ID]}{\texttt{http://localhost:8080/APIOAuth2/login.jsp?\linebreak client\_id=[CLIENT\_ID]}}
			\item En caso de que no esté dada de alta, se redireccionará a la siguiente página que indicará que no se dispone de permisos para confiar en la aplicación:\\
			\url{http://localhost:8080/APIOAuth2/loginOff.html}
		\end{enumerate}
	\item La página \textit{login.jsp} recogerá el nombre de usuario y contraseña y mediante una función Ajax en el archivo \textit{login.js} enviará los datos a través de un mensaje [POST] a la URL: \\
	\url{http://localhost:8080/APIOAuth2/ProcessGrant}
	\begin{enumerate}
		\item En el método \textit{ProcessGrant.doPost()} se comprobará si el usuario existe en la API a través del método \textit{DAOLogin.existUser}.
		\begin{enumerate}
			\item En caso de que exista se volverá a la función Ajax del archivo \textit{login.js} y se llamará a la función \textit{callProcess} que redireccionará mediante el método [GET] a:\\
			\url{http://localhost:8080/APIOAuth2/ProcessGrant}
		\end{enumerate}
		\item En el método \textit{ProcessGrant.doGet()}:
			\begin{enumerate}
				\item Se generará el \textbf{AUTHORIZATION\_CODE} a través de la clase \textit{RandomStringGenerator()}.  
				\item Se comprueba que existe el \textbf{CLIENT\_ID} a través del método \textit{DAOSetAuthorizationCode.existApp} y si existe se añadirá la dupla \textbf{CLIENT\_ID} / \textbf{AUTHORIZATION\_CODE} a la BBDD de la API a través del método \textit{DAOSetAuthorizationCode.setApplication}.
				\item Se realizará una redirección a la aplicación para facilitarle el \textbf{AUTHORIZATION\_CODE}, a través de un mensaje [GET] a la URL:\\
				\href{http://localhost:8080/ApplicationOAuth2/ResponseAuthorization?code=[AUTHORIZATION_CODE]&client_id=[CLIENT_ID]}{\texttt{http://localhost:8080/ApplicationOAuth2/\linebreak ResponseAuthorization?code=[AUTHORIZATION\_CODE]\&\linebreak client\_id=[CLIENT\_ID]}}
			\end{enumerate}
	\end{enumerate} 
	\item El método \textit{ResponseAuthorization.doGet()} en el lado de la aplicación, procesará la respuesta:
		\begin{enumerate}
			\item Se comprobará que el \textbf{CLIENT\_ID} existe en la BBDD de la aplicación mediante el método \textit{DAOSearch.existClient}.
			\item Se solicitará el \textbf{CLIENT\_SECRET} mediante el método \textit{DAOSearch.returnClientSecret}.
			\item Se realizará una redirección mediante un mensaje [GET] a la API con la siguiente URL:\\
			\href{http://localhost:8080/APIOAuth2/GrantAuthorization/SecondStep?client_id=[CLIENT_ID]&client_secret=[CLIENT_SECRET]&code=[AUTHORIZATION_CODE]&redirect_uri=http://localhost:8080/ApplicationOAuth/GrantAuthorization}{\texttt{http://localhost:8080/APIOAuth2/GrantAuthorization/\linebreak SecondStep?client\_id=[CLIENT\_ID]\&\linebreak client\_secret=[CLIENT\_SECRET]\& code=[AUTHORIZATION\_CODE]\&\linebreak redirect\_uri=http://localhost:8080/ApplicationOAuth/\linebreak GrantAuthorization}}
		\end{enumerate}	
	\item El método \textit{ListenerGrant.doGet()} en el lado de la API, procesará la respuesta:
	\begin{enumerate}
		\item Se comprueba a través del método \textit{DAOSearch.existApp} en una primera instancia si se tiene almacenado alguna aplicación que disponga de un \textbf{CLIENT\_ID} asociado al \textbf{AUTHORIZATION\_CODE} que nos están remitiendo y si eso se cumple, en una segunda instancia se comprobará si existe un \textbf{CLIEN\_ID} asociado al \textbf{CLIENT\_SECRET} que nos están facilitando.
		\begin{enumerate}
			\item En caso de que se cumpla a través del método \textit{DAOInsert.setCorrectGrant} se almacenará toda la información sobre dicha concesión de autorización.
		\end{enumerate} 
		\item Mediante el método \textit{ListenerGrant.responsePost()} se creará un JSON que albergue toda la información para la finalización del proceso de concesión de autorización. Dicho JSON contendrá los siguientes datos:\\
		\href{request: {'access_token': '[ACCESS_TOKEN]','token_type': 'bearer','expires_in': '[EXPIRES_IN]','refresh_token': '[REFRESH_TOKEN]','scope': 'read'}}{\texttt{request: {'access\_token': '[ACCESS\_TOKEN]',\linebreak 'token\_type': 'bearer',\linebreak 'expires\_in': '[EXPIRES\_IN]',\linebreak 'refresh\_token': '[REFRESH\_TOKEN]',\linebreak 'scope': 'read'}}}
		\item Se realizará mediante un método [POST] la siguiente llamada:\\
		\url{http://localhost:8080/ApplicationOAuth/GrantAuthorization}
	\end{enumerate}
	\item El método \textit{Application.doPost()} en el lado de la aplicación, procesará la respuesta:
	\begin{enumerate}
		\item Se extraerá la información contendia en el JSON y mediante el método \textit{DAOValueApplicationRequest.setApplicationCredentials} se inicializarán dichos parámetros en la BBDD.
	\end{enumerate}
\end{enumerate}


%% IMPORTANTE  DIAGRAMA ENTIDAD-RELACIÓN %%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RESULTADOS %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Resultados}

El resultado final que se quería conseguir era la realización completa de un proceso de autorización utilizando el protocolo OAuth 2.0. Para ello los puntos esenciales que tenían que cumplirse eran los siguientes:

\begin{enumerate}
	\item Realización de un proceso de autenticación de usuarios en la aplicación principal. Para esto se requería que los datos del usuario estuvieran almacenados en una BBDD a la cuál se tenía que acceder y comprobar si el nombre de usuario y contraseña estaban dados de alta como dupla. Se realiza la gestión tanto de los accesos correctos como de aquellos que resultan erróneos.
	\item Realización de un proceso de alta y baja de aplicaciones en la API. Para este proceso resultaba imprescindible que dicha gestión estuviera llevada a cabo únicamente por el usuario administrador. 
	Dentro de las competencias de las que dispondría el administrador, estaría las de realizar la petición de alta de la aplicación en la API y la de enviar la solicitud de baja de la lista de confianza de la API de la aplicación.
	\item Realización de un proceso completo de autorización de la aplicación principal en la API, siguiendo para ello el estándar RFC 6749~\cite{hardt2012rfc}. El proceso completo tenía que basarse íntegramente en la concesión por código de autorización. El proceso ha consistido en conseguir un token mediante el cuál se accedía a un determinado grado de autorización para la consulta de recursos. 
\end{enumerate}

Aunque podemos concluir que el objeto principal de este proyecto se ha conseguido al 100\%, la creación de un proceso mediante el cual se pudiera ver en acción el uso del token de autorización hubiera sido, visualmente más atractivo.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONCLUSIONES %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
Au\chapter{Conclusiones}
\label{chap:conclusiones}

En los capítulos anteriores se ha presentado el estudio de la documentación y la motivación de realizar este proyecto. También se ha desarrollado una implementación de dicho protocolo (RFC 6749)~\cite{hardt2012rfc} y analizado el comportamiento bajo diversas circunstancias.


\section{Conclusiones}
\label{sec:consecucion-objetivos}

%Esta sección es la sección espejo de las dos primeras del capítulo de objetivos, donde se planteaba el objetivo general y se elaboraban los específicos.

%Es aquí donde hay que debatir qué se ha conseguido y qué no. 
%Cuando algo no se ha conseguido, se ha de justificar, en términos de qué problemas se han encontrado y qué medidas se han tomado para mitigar esos problemas.

Tras las realización de las pruebas del correcto funcionamiento de la implementación podemos concluir que la solución desarrollada cubre las espectativas alcanzadas sobre la motivación inicial.

Se ha creado una web que simula el protocolo OAuth 2.0 y se ha realizado de la forma más intuitiva y completa que se ha podido idear. 

El desarrollo que se ha seguido es el mismo que se utiliza en las empresas, utilizando patrones de nombres, activando archivos de log para su posterior estudio y facilidad en el análisis de la pila de código, utilizando un servidor de aplicaciones de código abierto (WildFly) y un sistema de automatización de construcción de código abierto (Gradle). 

El estudio y desarrollo de este proyecto me han aportado un gran abanico de conocimientos del que antes no disponía, ya que la implementación no se ha realizado utilizando programas conocidos o con los que antes había trabajado y me sentía cómodo, si no que he preferido ir por la línea del si no usando herramientas nuevas que necesitaban de un estudio desde cero del producto. En lugar de Tomcat se ha usado WildFly, en lugar de Maven se ha usado Gradle y en lugar de Oracle he utilizado PostgreSQL


\section{Trabajos futuros}
\label{sec:trabajos_futuros}
Como trabajo futuro propondría dos líneas de desarrollo:
\begin{enumerate}
	\item Por una parte y tal como se indicaba en la introducción, la autorización no deja de ser una de las dos ramas que deberían tenerse en cuenta para disponer de un mecanismo completo de seguridad. La otra rama, la de autenticación, se trata de forma simplificada en este proyecto. Por lo que un trabajo futuro podría ser:
	\begin{enumerate}
		\item La realización de un mecanismo de autenticación de usuarios. Dicho mecanismo podría basarse en Infraestructura de Clave Pública y combinarlo con otro mecanismo como puede ser el mecanismo OTP (One Time Password) que añade un nivel de seguridad adicional al solicitar una clave que se envía al teléfono o correo electrónico que tenga asociado el usuario.
		\item La unión de este proyecto con la API que pueda proporcionar el OpenID Foundation.
	\end{enumerate}	
	\item Una segunda línea de desarrollo podría ser la de hacer más visual este proyecto pudiendo utilizar el ACCESS\_TOKEN que se termina obteniendo para solicitar la información que se requiera que tenga disponible el usuario en la Web final de la API. El grado de información al que se podría acceder variaría teniendo en cuenta el 'scope' que se haya proporcionado.
\end{enumerate}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% APÉNDICE(S) %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\appendix


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BIBLIOGRAFIA %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage

% Las siguientes dos instrucciones es todo lo que necesitas
% para incluir las citas en la memoria
\bibliographystyle{abbrv}
\bibliography{memoria}  % memoria.bib es el nombre del fichero que contiene
% las referencias bibliográficas. Abre ese fichero y mira el formato que tiene,
% que se conoce como BibTeX. Hay muchos sitios que exportan referencias en
% formato BibTeX. Prueba a buscar en http://scholar.google.com por referencias
% y verás que lo puedes hacer de manera sencilla.
% Más información: 
% http://texblog.org/2014/04/22/using-google-scholar-to-download-bibtex-citations/

\end{document}
